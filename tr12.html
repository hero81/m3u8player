<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON 地址生成器</title>
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --ios-background: #F2F2F7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        body {
            background-color: var(--ios-background);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--ios-gray);
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .match-type-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .match-type-label {
            min-width: 70px;
            color: var(--ios-gray);
            font-size: 14px;
            margin-right: 16px;
        }
        
        .radio-group {
            display: flex;
            gap: 32px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 16px;
            white-space: nowrap;
        }
        
        button {
            background: var(--ios-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #F8F8F8;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result p {
            margin: 8px 0;
            word-break: break-all;
        }
        
        .loading {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--ios-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .progress {
            margin-top: 10px;
            font-size: 14px;
            color: var(--ios-gray);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 响应式设计 */
        @media (max-width: 600px) {
            body {
                padding: 8px;
            }
            .container {
                padding: 12px;
                border-radius: 0;
                box-shadow: none;
            }
            h1 {
                font-size: 20px;
            }
            .form-group, .match-type-group {
                margin-bottom: 14px;
            }
            input, select, button {
                font-size: 15px;
                padding: 10px;
            }
            .radio-group {
                gap: 16px;
            }
            .result {
                font-size: 14px;
                padding: 10px;
            }
        }

        .case-group {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .case-label {
            min-width: 70px;
            margin-right: 16px;
            color: var(--ios-gray);
            font-size: 14px;
        }
        .switch-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            cursor: pointer;
            user-select: none;
        }
        .switch-input {
            display: none;
        }
        .switch-slider {
            position: relative;
            width: 40px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            transition: background 0.2s;
        }
        .switch-slider::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 3px;
            width: 18px;
            height: 18px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .switch-input:checked + .switch-slider {
            background: #34C759;
        }
        .switch-input:checked + .switch-slider::before {
            transform: translateX(16px);
        }

        .copyable {
            cursor: pointer;
            color: var(--ios-blue);
            user-select: all;
            transition: background 0.2s;
        }
        .copyable.copied {
            background: #e0f3ff;
        }

        .input-error {
            color: #ff3b30;
            font-size: 13px;
            margin-top: 4px;
            min-height: 18px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TRON 地址生成器</h1>
        
        <div class="form-group">
            <label>匹配内容</label>
            <input type="text" id="targetContent" placeholder="输入要匹配的内容（*为通配符，最多8个字符）" maxlength="8">
            <div class="progress" id="contentLength"></div>
            <div id="inputError" class="input-error"></div>
        </div>
        
        <div class="form-group match-type-group">
            <label class="match-type-label">匹配方式</label>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="matchType" value="suffix" checked>
                    后缀匹配
                </label>
                <label class="radio-option">
                    <input type="radio" name="matchType" value="contains">
                    包含匹配
                </label>
            </div>
        </div>
        <div class="form-group case-group">
            <label class="case-label">区分大小写</label>
            <label class="switch-label">
                <input type="checkbox" id="caseSensitive" class="switch-input">
                <span class="switch-slider"></span>
            </label>
        </div>
        
        <button id="generateBtn">开始生成</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>正在生成中...</p>
            <div class="progress" id="progress"></div>
        </div>
        
        <div class="result" id="result">
            <p><strong>地址：</strong><span id="address" class="copyable" title="点击复制"></span></p>
            <p><strong>私钥：</strong><span id="privateKey" class="copyable" title="点击复制"></span></p>
            <p><strong>尝试次数：</strong><span id="attempts"></span></p>
            <p><strong>耗时：</strong><span id="time"></span>秒</p>
        </div>
    </div>

    <script>
        let isGenerating = false;
        let totalAttempts = 0;
        let startTime = null;
        const generateBtn = document.getElementById('generateBtn');
        const targetContent = document.getElementById('targetContent');
        const contentLength = document.getElementById('contentLength');

        // 监听匹配内容输入变化
        targetContent.addEventListener('input', function() {
            // 只允许字母、数字和*
            let filtered = this.value.replace(/[^a-zA-Z0-9\*]/g, '');
            if (filtered !== this.value) {
                this.value = filtered;
            }
            const length = this.value.length;
            contentLength.textContent = length > 0 ? `当前长度：${length}` : '';
        });

        // 生成随机私钥
        function generateRandomPrivateKey() {
            const bytes = new Uint8Array(32);
            crypto.getRandomValues(bytes);
            return Array.from(bytes)
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // 生成 TRON 地址
        async function generateTronAddress(privateKey) {
            const publicKey = await getPublicKeyFromPrivateKey(privateKey);
            return getTronAddressFromPublicKey(publicKey);
        }

        // 从私钥生成公钥
        async function getPublicKeyFromPrivateKey(privateKey) {
            const privateKeyBuffer = hexToBuffer(privateKey);
            const publicKeyBuffer = new Uint8Array(65);
            
            const hashBuffer = await crypto.subtle.digest('SHA-256', privateKeyBuffer.buffer);
            const hash = new Uint8Array(hashBuffer);
            
            publicKeyBuffer[0] = 0x04;
            publicKeyBuffer.set(hash.slice(0, 32), 1);
            publicKeyBuffer.set(hash.slice(32, 64), 33);
            
            return publicKeyBuffer;
        }

        // 从公钥生成 TRON 地址
        async function getTronAddressFromPublicKey(publicKey) {
            const hashBuffer = await crypto.subtle.digest('SHA-256', publicKey.buffer);
            const hash = new Uint8Array(hashBuffer);
            
            const addressBytes = hash.slice(-20);
            const addressWithPrefix = new Uint8Array(21);
            addressWithPrefix[0] = 0x41;
            addressWithPrefix.set(addressBytes, 1);
            
            const checksumBuffer = await crypto.subtle.digest('SHA-256', addressWithPrefix.buffer);
            const checksum = new Uint8Array(checksumBuffer);
            const checksumBytes = checksum.slice(0, 4);
            
            const finalAddress = new Uint8Array(25);
            finalAddress.set(addressWithPrefix, 0);
            finalAddress.set(checksumBytes, 21);
            
            return base58Encode(finalAddress);
        }

        // 十六进制字符串转 Buffer
        function hexToBuffer(hex) {
            const buffer = new Uint8Array(hex.length / 2);
            for (let i = 0; i < hex.length; i += 2) {
                buffer[i / 2] = parseInt(hex.substr(i, 2), 16);
            }
            return buffer;
        }

        // Base58 编码
        function base58Encode(buffer) {
            const ALPHABET = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
            const base = ALPHABET.length;
            let num = BigInt(0);
            
            for (let i = 0; i < buffer.length; i++) {
                num = num * BigInt(256) + BigInt(buffer[i]);
            }
            
            let str = '';
            while (num > 0) {
                const mod = Number(num % BigInt(base));
                str = ALPHABET[mod] + str;
                num = num / BigInt(base);
            }
            
            for (let i = 0; i < buffer.length && buffer[i] === 0; i++) {
                str = '1' + str;
            }
            
            return str;
        }

        async function generateAddress() {
            const targetContent = document.getElementById('targetContent').value;
            const matchType = document.querySelector('input[name="matchType"]:checked').value;
            const caseSensitive = document.getElementById('caseSensitive').checked;
            const inputError = document.getElementById('inputError');
            
            if (!targetContent) {
                inputError.textContent = '请输入匹配内容';
                return;
            } else {
                inputError.textContent = '';
            }
            
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const progress = document.getElementById('progress');
            
            if (!window.crypto || !window.crypto.subtle || !window.crypto.getRandomValues) {
                inputError.textContent = '当前浏览器不支持安全加密运算，建议使用Chrome 或其他浏览器';
                return;
            }
            
            isGenerating = true;
            generateBtn.textContent = '停止生成';
            loading.classList.add('show');
            result.classList.remove('show');
            totalAttempts = 0;
            startTime = Date.now();
            
            // 构造正则表达式
            let pattern = targetContent.replace(/\*/g, '[0-9]');
            if (matchType === 'suffix') {
                pattern = pattern + '$';
            }
            const flags = caseSensitive ? '' : 'i';
            const regex = new RegExp(pattern, flags);
            
            try {
                while (isGenerating) {
                    const privateKey = generateRandomPrivateKey();
                    const address = await generateTronAddress(privateKey);
                    totalAttempts++;
                    
                    if (totalAttempts % 100 === 0) {
                        progress.textContent = `已尝试 ${totalAttempts.toLocaleString()} 次`;
                    }
                    
                    if (regex.test(address)) {
                        document.getElementById('address').textContent = address;
                        document.getElementById('privateKey').textContent = privateKey;
                        document.getElementById('attempts').textContent = totalAttempts.toLocaleString();
                        document.getElementById('time').textContent = ((Date.now() - startTime) / 1000).toFixed(2);
                        
                        result.classList.add('show');
                        isGenerating = false;
                        generateBtn.textContent = '开始生成';
                        break;
                    }
                    
                    // 每生成1000个地址暂停一下，避免阻塞主线程
                    if (totalAttempts % 1000 === 0) {
                        await new Promise(resolve => setTimeout(resolve, 0));
                    }
                }
            } catch (error) {
                inputError.textContent = '生成失败，请重试';
                isGenerating = false;
                generateBtn.textContent = '开始生成';
            } finally {
                loading.classList.remove('show');
            }
        }

        generateBtn.addEventListener('click', () => {
            if (isGenerating) {
                isGenerating = false;
                generateBtn.textContent = '开始生成';
            } else {
                generateAddress();
            }
        });

        // 复制功能
        function addCopyListener(id) {
            const el = document.getElementById(id);
            el.addEventListener('click', async function() {
                if (!el.textContent) return;
                try {
                    await navigator.clipboard.writeText(el.textContent);
                    el.classList.add('copied');
                    const old = el.textContent;
                    el.textContent = '已复制';
                    setTimeout(() => {
                        el.classList.remove('copied');
                        el.textContent = old;
                    }, 800);
                } catch (e) {
                    document.getElementById('inputError').textContent = '复制失败，请手动复制';
                }
            });
        }
        addCopyListener('address');
        addCopyListener('privateKey');
    </script>
</body>
</html> 
