<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRON 地址生成器</title>
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --ios-background: #F2F2F7;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }
        
        body {
            background-color: var(--ios-background);
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--ios-gray);
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #E5E5EA;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }
        
        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 8px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        button {
            background: var(--ios-blue);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            width: 100%;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #F8F8F8;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result p {
            margin: 8px 0;
            word-break: break-all;
        }
        
        .loading {
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--ios-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        .progress {
            margin-top: 10px;
            font-size: 14px;
            color: var(--ios-gray);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TRON 地址生成器</h1>
        
        <div class="form-group">
            <label>匹配内容</label>
            <input type="text" id="targetContent" placeholder="输入要匹配的内容">
        </div>
        
        <div class="form-group">
            <label>匹配长度</label>
            <input type="number" id="contentLength" min="1" max="10" value="4">
        </div>
        
        <div class="form-group">
            <label>匹配方式</label>
            <div class="radio-group">
                <label class="radio-option">
                    <input type="radio" name="matchType" value="suffix" checked>
                    后缀匹配
                </label>
                <label class="radio-option">
                    <input type="radio" name="matchType" value="contains">
                    包含匹配
                </label>
            </div>
        </div>
        
        <button id="generateBtn">开始生成</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>正在生成中...</p>
            <div class="progress" id="progress"></div>
        </div>
        
        <div class="result" id="result">
            <p><strong>地址：</strong><span id="address"></span></p>
            <p><strong>私钥：</strong><span id="privateKey"></span></p>
            <p><strong>尝试次数：</strong><span id="attempts"></span></p>
            <p><strong>耗时：</strong><span id="time"></span>秒</p>
        </div>
    </div>

    <script>
        let isGenerating = false;
        let totalAttempts = 0;
        let startTime = null;
        let batchId = 0;
        let abortController = null;

        async function generateAddress() {
            const targetContent = document.getElementById('targetContent').value.toLowerCase();
            const contentLength = parseInt(document.getElementById('contentLength').value);
            const matchType = document.querySelector('input[name="matchType"]:checked').value;
            
            if (!targetContent) {
                alert('请输入匹配内容');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            const progress = document.getElementById('progress');
            
            isGenerating = true;
            btn.disabled = true;
            loading.classList.add('show');
            result.classList.remove('show');
            totalAttempts = 0;
            startTime = Date.now();
            batchId = 0;
            
            // 创建新的 AbortController
            abortController = new AbortController();
            
            try {
                while (isGenerating) {
                    const response = await fetch('/generate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            targetContent,
                            contentLength,
                            matchType,
                            batchId: batchId++,
                            startTime
                        }),
                        signal: abortController.signal
                    });
                    
                    const data = await response.json();
                    totalAttempts += data.attempts;
                    
                    progress.textContent = `已尝试 ${totalAttempts.toLocaleString()} 次，当前批次 ${batchId}`;
                    
                    if (data.status === 'success') {
                        document.getElementById('address').textContent = data.address;
                        document.getElementById('privateKey').textContent = data.privateKey;
                        document.getElementById('attempts').textContent = totalAttempts.toLocaleString();
                        document.getElementById('time').textContent = data.totalTime.toFixed(2);
                        
                        result.classList.add('show');
                        isGenerating = false;
                        break;
                    }
                    
                    // 添加小延迟，避免请求过于频繁
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('生成已停止');
                } else {
                    alert('生成失败，请重试');
                }
                isGenerating = false;
            } finally {
                btn.disabled = false;
                loading.classList.remove('show');
            }
        }

        document.getElementById('generateBtn').addEventListener('click', () => {
            if (isGenerating) {
                // 如果正在生成，则停止
                isGenerating = false;
                if (abortController) {
                    abortController.abort();
                }
                document.getElementById('generateBtn').textContent = '开始生成';
            } else {
                // 开始生成
                document.getElementById('generateBtn').textContent = '停止生成';
                generateAddress();
            }
        });
    </script>
</body>
</html> 
